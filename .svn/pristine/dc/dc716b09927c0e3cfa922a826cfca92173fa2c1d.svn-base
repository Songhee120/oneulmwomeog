<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE HTML>
<!--
   Astral by Pixelarity
   pixelarity.com | hello@pixelarity.com
   License: pixelarity.com/license
-->
<html>
<head>
<title>Untitled</title>
<meta charset="utf-8" />
<meta name="viewport"
   content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" href="../assets/css/main.css?ver=1" />
<link rel="stylesheet" href="../assets/css/astral.css?ver=7" />
<link rel="stylesheet" href="../assets/css/prac.css?ver=8" />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">

<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
<noscript>
   <link rel="stylesheet" href="../assets/css/noscript.css" />
</noscript>
</head>
<style>
*{
   font-family: 'Do Hyeon', sans-serif;
}

span.holy {
   font-family: 궁서;
   font-size: 40px;
   color: pink;
}
.bar{
	margin:0 3px;
	width:1px;
	height:7px;
	vertical-align:center;
	font-size:12px;
	margin-left:6px;
	padding-top:1px;
}
</style>
<style>
	
	
</style>

<body class="is-preload">
	
   <c:if test="${mem_id eq null}">
   		<script>
   			alert("로그인 후 이용해주세요.");
   			location.replace("${pageContext.request.contextPath}/member/MemberLogin.me");
   		</script>
   </c:if> 
   <!-- Wrapper-->
   <div id="wrapper">

      <!-- Nav -->
      <nav id="nav" style="">
         <a href="#home" class="icon solid fa-home"><span>Home</span></a> <a
            href="#post" onclick="best()" class="icon solid fa-folder"><span>Post</span></a>
         <a href="#myPage" onclick="myPageAction()" class="far fa-id-card"><span>MyPage</span></a>
      </nav>

      <!-- Main -->
      <div id="main">

         <!-- Me -->
         <article id="home" class="panel" style="padding-top:2.5em;">
            <section id="my_home">
               <header id="home_header">
                  <div id="home_header_div1">
                     <img src="../images/mainlogo.png" id="home_img">
                  </div>
                  <div id="home_header_div2">
                     <span id="home_name">오늘 뭐먹</span>
                  </div>
               </header>
               <div id="my_home_div1">
                  <div id="home_div1-1" style="height: 50px;">
                     <span>WE HAVE TO EAT,ONEULMWOMEOG</span>
                  </div>
                  <div style="height: 50px;">
                     <span>FOOD FOREVER</span>
                  </div>
               </div>
               <div id="my_home_div2">
                  <button id="home_select_btn" onclick="foodClicked()">밥먹을래?</button>
                  <button id="home_select_btn" onclick="dessertClicked()">카페 갈래?</button>
               </div>
            </section> 
            
            <!-- 음식뭐먹? 시작 -->
            <section id="food_area">

               <!-- 랜덤 뿌려주는 곳 -->
               <div class="random_area">
                  <p>
                     그렇다면 오늘은 <span id="food_name" style="color: pink; font-size: 40px;">???</span>먹!
                  </p>
               </div>
               <!-- 랜덤 뿌려주는 곳 끝! -->

               <!-- select & 비회원 시작 -->
               <div class="selectNmapLeft">
                  <div class="select_nonMember">
                     <div class="select_area">
                        <select id= "ppl_count" name="ppl_count" style="width: 120px;">
                           <option value="" disabled selected>오늘은 몇명?</option>
                           <option value="0">혼자</option>
                           <option value="1">두명 이상</option>
                           <option value="2">단체</option>
                        </select> 
                        <select name="price" style="width: 100px;">
                           <option value="" disabled selected>얼마있니?</option>
                           <option value="2">만원 이상</option>
                           <option value="1">만원 이하</option>
                           <option value="0">가격 무관</option>
                        </select> 
                        <select name="starv_level" style="width: 100px;">
                           <option value="" disabled selected>굶주림</option>
                           <option value="3">굶주림</option>
                           <option value="2">배고픔</option>
                           <option value="1">출출함</option>
                        </select>
                        <select name="distance" style="width: 60px;">
                           <option value="" disabled selected>반경</option>
                           <option value="halfkilo">500m</option>
                           <option value="onekilo">1km</option>
                           <option value="twokilo">2km</option>
                        </select>
                     </div>
                     <div style="text-align:center;">
                        <button type="submit" value="확인" onclick="getRandomFood()">확인</button>
                       </div>
                           <!-- <div class="non_member">
                        <input type="text" placeholder="주소를 입력하세요">
                         </div> -->
                  </div>
                  <!-- select & 비회원 끝 -->

                  <!-- 지도 api 구현 -->
                  <div class="map_api">
                     <img src="../images/map.jpg" />
                  </div>
                  <!-- 지도 api 구현 끝! -->
               </div>

               <div class="food_listRight">
                  <!-- 주변 맛집  리스트 구현-->
                  <div class="food_list">
                     <img src="../images/foodList.jpg" />
                  </div>
                  <!-- 주변 맛집  리스트 구현 끝!-->
               </div>

               <!-- 확인 버튼 부분  -->
               <div class="food_submit">
                  <button type="submit" value="확인" onclick="letsGo()">확인</button>
               </div>
               <!-- 확인 버튼 부분 끝 -->
            </section>
            <!-- 음식뭐먹? 구현 끝 -->

            <!-- 음식 길 찾기 -->
            <section id="find_road">
               <header>
                  <h2>길찾기</h2>
               </header>
               <div class="road_area">
                  <img src="../images/find_road.jpg" />
               </div>
            </section>
            <!-- 음식 길 찾기 끝 -->

            <!-- 후식 뭐먹 시작! -->
            <section id="dessert_area">

               <div class="hello_dessert">
                  <p>오늘 뭐먹?</p>
               </div>

               <!-- 후식 select -->
               <div class="dessertSelectNmapLeft">
                  <div class="dessert_selectNnonMember">
                     <div class="dessertSelect_area">
                        <select name="choice">
                           <option value="" disabled selected>지금어디?</option>
                           <option value="halfkilo">500m</option>
                           <option value="onekilo">1km</option>
                           <option value="twokilo">2km</option>
                        </select>
                     </div>
                     <div class="dessertNon_member">
                        <input type="text" placeholder="주소를 입력하세요">
                     </div>
                  </div>
                  <!-- select 끝-->

                  <!-- 후식 지도 api 구현 -->
                  <div class="dessertMap_api">
                     <img src="../images/dessert_map.png" />
                  </div>
                  <!-- 지도 api 구현 끝! -->
               </div>

               <div class="dessert_listRight">
                  <!-- 주변 후식  리스트 구현-->
                  <div class="dessert_list">
                     <img src="../images/dessert_list.png" />
                  </div>
                  <!-- 주변 후식  리스트 구현 끝!-->
               </div>

               <!-- 확인 버튼 부분  -->
               <div class="desset_submit">
                  <button type="submit" value="확인" onclick="letsGoDrink()">확인</button>
               </div>
               <!-- 확인 버튼 부분 끝 -->
            </section>
            <!-- 후식 뭐먹 끝! -->

            <!-- 후식 길 찾기 -->
            <section id="findDessert_road">
               <header>
                  <h2>길찾기</h2>
               </header>
               <div class="dessertRoad_area" style="">
                  <img src="../images/findDessert_road.png" />
               </div>
            </section>
            <!-- 후식 길 찾기 끝--> 
         </article>

                  <!-- Post -->
         <article id="post" class="panel" style="text-align: center;">
            <header>
               <h2>POST</h2>
            </header>
            <div style="text-align: center;">
               <span id="best" onclick="bestClicked()">BEST</span> <span id="new"
                  style="margin: 20px;" onclick="newImageClicked()">NEW</span><span
                  style="margin: 10px; color: #777777">|</span> <span id="write"
                  style="margin: 20px;"><a href="${pageContext.request.contextPath}/review/ReviewWrite.re"
                  style="color: rgb(119, 119, 119);">WRITE</a></span>
            </div>
            <!-- best 인증 -->
            <section id="best_area"style="display: block; text-align: center;">
               <div style="width: 100%; text-align: right;">
                  <div style="width:100%; height:15px;">
                  </div>
                  </div>
               <br>
               <div class="row" id="best_view">               
               </div>
               <br>
            </section>
            <!-- new 인증_이미지 -->
            <section id="new_image_area" style="display: none; text-align: center;">
               <div style="width: 100%; text-align: right;">
                  <div style="width:100%; height:15px;">
                     <span id="new_image" onclick="newImageClicked()"><select
                        class="select_choice">
                           <option value="" style="color: #777777">선택</option>
                           <option value="local">지역</option>
                           <option value="name">상호명</option>
                     </select> <input id="notices_search" maxlength="50" type="search" style="height:23px">
                        <!--12-08  --> <input id="search_btn" type="button" value="검색"></span>
                  </div>
            
               <br>
               <div class="row" id="best_view">
               </div>
               <br>
      
            </section>
            <!-- new 인증_텍스트 -->
            <!-- 변경한 부분은 태그 안에서 직접 변경함 -->

         </article>

          <article id="myPage" class="panel" style="color:black;">
				<header style="margin:8px;">
					<h2 style="text-align:center;">마이페이지</h2>
				</header>
				<hr style="padding:0px;margin:auto;">
				<section style="height:700px;">
					<!--사용자 -->
					<div class="row" style="padding:0px;height:10%;margin:0 auto;">
						<div style="line-height:70px;padding:0px;display:inline-block;width:10%;text-align:center;height:100%;">
							<img src="" id="user_img">
						</div>
						<div style="padding:0px;display:inline-block;width:50%;">
							<div style="padding:0px;display:block;height:35px;">
								<span id="user_name"></span>
								<a href="${pageContext.request.contextPath}/member/MemberMydetail.me"><button id="my_inform_btn" onclick="move_my_inform()">내 정보</button></a>
							</div>
							<div style="padding:0px;display:block;height:35px;line-height:45px;">
								<span id="user_nickname" ></span>
							</div>
						</div>
						<div style="text-align:right;float:right;width:40%;padding:0px;">				
							<span><span id="user_point"></span><img src="../images/point.png" id="my_point_img"></span>
							<a href=" ${pageContext.request.contextPath}/member/MemberLogOut.me"><button id="logout_btn">로그 아웃</button></a>
						</div>
					</div><hr style="margin:0px;padding:0px;">		
					<nav id="mypage_nav">						 
						<div class="row" id="nav" style="padding:0px;height:100%;margin:0 auto;">
							 <div style="height:50%;padding:0px;width:100%">
								<div class="six_div">
									<div class="my_img_div">
										<a href="#" class="my_img_a">
										<img src="../images/present.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>이벤트</span>
									</div>
								</div>
								<div class="six_div">
									<div class="my_img_div">
										<a href="#" class="my_img_a">
										<img src="../images/discount.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>쿠폰함</span>
									</div>
								</div>
								<div class="six_div">
									<div class="my_img_div">
										<a href="${pageContext.request.contextPath}/notice/NoticeList.no" class="my_img_a">
										<img src="../images/notice.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>공지사항</span>
									</div>
								</div>
								
							</div>
							<div style="height:50%;padding:0px;width:100%">
								<div class="six_div">
									<div class="my_img_div">
										<a href="#" class="my_img_a">
										<img src="../images/zzim.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>찜 목록</span>
									</div>
								</div>
								<div class="six_div">
									<div class="my_img_div">
										<a href="#" class="my_img_a">
										<img src="../images/certify.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>인증 목록</span>
									</div>
								</div>
								<div class="six_div">
									<div class="my_img_div">
										<a href="#" class="my_img_a">
										<img src="../images/custom_center.png"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>고객센터</span>
									</div>
								</div>
							</div>																						
						</div>
					</nav><hr style="margin:0px;padding:0px;">	
					<div class="row" id="main" style="padding:0px;height:47%;margin:0 auto;">
						<div id="my_alarm">
							<div style="width:20%;display:inline-block;height:100%;">
								<span>알람</span>
							</div>
							<div style="width:80%;float:right;text-align:right;height:100%"><button id="alarm_delete"><span>전체 삭제</span></button></div>
						</div>
						<div id="my_zzim">
							<div id="my_zzim_inner_div">
								<div class="my_zzim_div">
									<div id="my_zzim_div_1">
										<span id="my_zzim_date">12/2 <span>AM)12:16</span></span>
										<span>|</span>
										<span>쌍용 부부...</span>
									</div>
									<div id="my_zzim_div_2">
										<span id="my_zzim_review"><span>Eungeun</span>님이 좋아요!</span>
									</div>
									<div id="my_zzim_div_3">
										<button id="my_cancel_btn"><img src="../images/x_img.jpg" id="cancel_img"></button>
									</div>
								</div>
								<div></div>
								<div></div>
								<div></div>
							</div>
						</div>
						
			
					</div>
				</section>
			</article>
      </div>
	  
      <!-- Footer -->
      <div id="footer">
         <ul class="copyright">
            <li>&copy; Untitled.</li>
         </ul>
      </div>

   </div>
   <!-- Scripts -->
   <script src="../assets/js/jquery.min.js"></script>
   <script src="../assets/js/browser.min.js"></script>
   <script src="../assets/js/breakpoints.min.js"></script>
   <script src="../assets/js/util.js"></script>
   <script src="../assets/js/main.js"></script>
</body>
<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="../assets/js/astral.js"></script>
<script>var contextPath = "${pageContext.request.contextPath}"</script>
<script>


	var random_food;
	
	var food_name = document.getElementById("food_name");
	
	function getRandomFood(){
	   var ppl_count = $("select[name='ppl_count']").val();
	   var price = $("select[name='price']").val();
	   var starv_level = $("select[name='starv_level']").val();
	   
	   var allData = {"ppl_count": ppl_count, "price": price, "starv_level": starv_level};
	   
	   $.ajax({
	      url: contextPath + "/food/FoodRandomChoiceOk.fo",
	      type: "get",
	      data: allData,
	      dataType:"text",
	      success: function(data){
	         random_food = data.trim();
	         food_name.innerHTML = random_food;
	      }
	   })
	}


	$(".hover").mouseleave(function() {
		$(this).removeClass("hover");
	});
	
	function myPageAction(){
		   $.ajax({
		      url:contextPath + "/member/MemberMyPage.me",
		      type:"post",
		      dataType:"json",
		      success:function(mem){
		         $("#user_img").attr("src", contextPath + "/profile/" + mem.mem_profile);
		         $("#user_name").text(mem.mem_name);
		         $("#user_nickname").text(mem.mem_nickname);
		         $("#user_point").text(mem.mem_point);
		      },
		      error:function(mem){
		         alert("로딩 실패");
		      }
		   })
		}

	window.onload = function() {
		$.ajax({
			url : contextPath + "/member/MemberMyPage.me",
			type : "post",
			dataType : "json",
			success : function(mem) {
				$("#user_img").attr("src", contextPath + "/profile/" + mem.mem_profile);
		         $("#user_name").text(mem.mem_name);
		         $("#user_nickname").text(mem.mem_nickname);
		         $("#user_point").text(mem.mem_point);
			},
			error : function(mem) {
				alert("로딩 실패");
			}
		})
	}
	
	
	   //1분마다 ajax 실행
	   //setInterval과 다르게 함수 지연시간을 제외한 1분을 정확히 지키기 때문에
	   //정확한 간격으로 ajax가 실행될 수 있다.
	   setTimeout(function(){
		   best();
		   console.log("들어옴");
		},60000);
	   
	   function best(){
		   		 console.log("들어옴");
                 $.ajax({
               	  	   url : contextPath + "/review/ReviewBestView.re",
                       type : "get",
                       dataType : "json",
                       success : function(result) {
                       	var append = "";
                       	var rank = 1;
                           for (var i = 0; i < Object.keys(result).length; i++) {
                             var append_div = "";
                             append_div += "<div class='col-4 col-6-medium col-12-small'>";
                             append_div += "<figure class='snip1384'>";
                             append_div += "<img src='../upload/" + result[i].filename+"' alt='sample83' />";
                             append_div += "<figcaption>";
                             append_div += "<h3>"
                             append_div += (rank++) + "위";
                             append_div += "</h3>";
                             append_div += "<h3>";
                             append_div += result[i].res_name + "<br>";
                             append_div += "<span>";
                             for(var j = 0; j < result[i].review_star; j++){
                                append_div += "<c:out value='★'/>";
                             }
                             append_div += "</span>";
                             append_div += "</h3>";
                             append_div += "<p>"+ result[i].res_address+ "</p>";
                             append_div += "<i class='ion-ios-arrow-right'></i>";
                             append_div += "</figcaption>";
                             append_div += "<a href='"+contextPath+"/review/ReviewShowOk.re?review_no="+result[i].review_no+"'></a>";
                             append_div += "</figure>";
                             append_div += "</div>";
                             append += append_div;
                          }
                          $("#best_view").html(append);
                       },
                       error : function(result) {
                          alert("실패");
                       }
                    });
		   }
	   
	   $(window).scroll(function(){ 
			// 최하단일 경우를 체크하기 위해 최하단 위치값을 지정 
			// 화면 문서전체의 길이에서, 현재 창 높이를 뺀 것이 최하단 값 
			let scrollTop = $(window).scrollTop();
			let windowHeight = $(window).height();
			let documentHeight = $(document).height();
			if(scrollTop + windowHeight + 2 >= documentHeight){ 
				//함수 실행 
			}
		})
</script>

</html>