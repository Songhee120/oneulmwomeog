<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE HTML>
<!--
   Astral by Pixelarity
   pixelarity.com | hello@pixelarity.com
   License: pixelarity.com/license
-->
<html>

<head>

<title>유저 정보 수정</title>
<meta charset="utf-8" />
<meta name="viewport"
   content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" href="../assets/css/main.css" />
<link rel="stylesheet" href="../assets/css/astral.css?ver=1" />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&display=swap" rel="stylesheet">

<noscript>
   <link rel="stylesheet" href="../assets/css/noscript.css" />
</noscript>
</head>

<style>
#preview img {
	width: 100px;
	height: 100px;
	border-radius: 50px; /* 이미지 반크기만큼 반경을 잡기*/
}

.filebox {
	text-align: center;
}

.filebox label {
	display: inline-block;
	padding: .5em .75em;
	color: #999;
	font-size: inherit;
	line-height: normal;
	vertical-align: middle;
	background-color: #fdfdfd;
	cursor: pointer;
	border: 1px solid #ebebeb;
	border-bottom-color: #e2e2e2;
	border-radius: 50px;
}

.filebox input[type="file"] {
	/* 파일 필드 숨기기 */
	position: absolute;
	width: 1px;
	height: 1px;
	padding: 0;
	margin: -1px;
	overflow: hidden;
	clip: rect(0, 0, 0, 0);
	border: 0;
}

* {
	font-family: 'Black Han Sans', sans-serif;
}
span.holy {
	font-family: 궁서;
	font-size: 40px;
	color: pink;
}

</style>
<body class="is-preload">

   <!-- Wrapper-->
   <div id="wrapper">

      <!-- Nav -->
      <nav id="nav">
         <a href="#my_inform" class="fas fa-user-edit"><span>정보 수정</span></a>      
      </nav>

      <!-- Main -->
      <div id="main">
         <!--아이디 찾기 2020/11-27-->
         <!--  -->
         <article id="my_inform" class="panel">
            <header style="text-align: center;">
               <a href="login_index.jsp#home" style="text-decoration:none; font-size:45px; color:#ffcccc; font-weight:900;">오늘뭐먹</a>
            </header>
            <c:set var="mem_vo" value="${requestScope.mem_vo}"/>
            <form action="" method="post">
					<div class="col-12" style="margin: 0 auto; display: block;">
						<div class="filebox">
							<label for="upload">대표 사진 <input type='file' id='upload'
								name='upload' />
								<div id='preview'>
									<!-- 미리보기 공간 -->
								</div>
							</label>
						</div>
					</div>
					<div class="col-12" style="margin: 0 auto; display: block;">
						<label id="jogin_label">아이디<input id="email" type="text"
							name="email" value="${mem_vo.getMem_id()}"readonly/>
						</label>
					</div>
					<div class="col-12" style="margin: 0 auto; display: block;">
						<div style="padding: 0px;">
							<label style="margin: 0px; font-size: 20px; font-weight: bold;">닉네임</label>
						</div>
						<div style="padding: 0px;">
							<input type='text' name='input_nick'
								style="width: 75%; margin-left: 0px; display: inline-block;" value="${mem_vo.getMem_nickname()}" readonly />
							<input type="button" value="수정" id="mean_btn" name="nick_btn">
						</div>
					</div>
					<div class="col-12" style="margin: 0 auto; display: block;">
						<div style="padding: 0px;">
							<label style="margin: 0px; font-size: 20px; font-weight: bold;">이름</label>
						</div>
						<div style="padding: 0px;">
							<input type='text' readonly
								style="width: 100%; margin-left: 0px; display: inline-block;" value="${mem_vo.getMem_name()}" />
						</div>
					</div>
					<div class="col-12" style="margin: 0 auto; display: block;">
						<label id="jogin_label">생일<input id="email" type="text"
							name="email" readonly value="${mem_vo.getMem_birth()}"/>
						</label>
					</div>
					<div class="col-12" style="margin: 0 auto; display: block;">
						<div style="padding: 0px;">
							<label style="margin: 0px; font-size: 20px; font-weight: bold;">전화번호</label>
						</div>
						<div style="padding: 0px;">
							<input type='text' name='input_tel'
								style="width: 75%; margin-left: 0px; display: inline-block;" value="${mem_vo.getMem_tel()}" readonly />
							<input type="button"value="수정" id="mean_btn" name="tel_btn">
						</div>
					</div>
					<div class="col-12" style="margin-top:10px; text-align: center;">
						<a href="re_password.jsp">
							<button id="change_pw_btn"type="button" onclick="change_my_pw()">비밀번호 변경</button>
						</a>
					</div>
				</form>
         </article>    
      </div>

      <!-- Footer -->
      <div id="footer">
         <ul class="copyright">
            <li>&copy; Untitled.</li>
         </ul>
      </div>

   </div>

   <!-- Scripts -->
   <script src="../assets/js/jquery.min.js"></script>
   <script src="../assets/js/browser.min.js"></script>
   <script src="../assets/js/breakpoints.min.js"></script>
   <script src="../assets/js/util.js"></script>
   <script src="../assets/js/main.js"></script>
<script src="../assets/js/astral.js"></script>
</body>
<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
	var new_nickname = "";
	var notice = "";
	
	$("input[name='nick_btn']").click(function() {
		if ($("input[name='input_nick']").attr("readOnly")) {
			$("input[name='input_nick']").attr("readOnly", false);		
			$("input[name='nick_btn']").attr("value", "완료");
		} else {
			$("input[name='input_nick']").attr("readOnly", true);
			$("input[name='nick_btn']").attr("value", "수정");
			new_nickname = $("input[name='input_nick']").val();
			
			if(new_nickname == ""){
				notice = "변경할 닉네임을 입력하세요."
			}
	
			$.ajax({
				url : contextPath + "/member/MemberCheckNickOk.me?new_nickname=" + new_nickname,
				type : "get",
				dataType : "text",
				success : function(result){
						//중복된 닉네임이 있다.
						if(result.trim() == "not-ok"){
							notice = "이미 중복된 닉네임입니다!";							
						}
						//닉네임 변경 성공
						else if(result.trim() == "ok"){
							notice = "닉네임 변경 완료!";
						}
						//DB문제
						else{
							notice = "다시 시도해주세요.."
						}
						alert(notice);
				},
				error : function(){					
				}
			})
		}
	})
	
	$.ajax({
				url : contextPath + "/member/MemberCheckTelOk.me?new_tel=" + new_tel,
				type : "get",
				dataType : "text",
				success : function(result){
						//중복된 전화번호가 있다.
						if(result.trim() == "not-ok"){
							notice = "이미 중복된 닉네임입니다!";							
						}
						//전화번호 변경 성공
						else if(result.trim() == "ok"){
							notice = "닉네임 변경 완료!";
						}
						//DB문제
						else{
							notice = "다시 시도해주세요.."
						}
						alert(notice);
				},
				error : function(){					
				}
			})
		}
	})
	

	$("input[name='tel_btn']").click(function() {
		if ($("input[name='input_tel']").attr("readOnly")) {
			$("input[name='input_tel']").attr("readOnly", false);
			$("input[name='tel_btn']").attr("value", "완료");
		} else {
			$("input[name='input_tel']").attr("readOnly", true);
			$("input[name='tel_btn']").attr("value", "수정");
		}
	})

	var upload = document.querySelector('#upload');
	var upload2 = document.querySelector('#upload2');

	/* FileReader 객체 생성 */
	var reader = new FileReader();

	/* reader 시작시 함수 구현 */
	reader.onload = (function() {

		this.image = document.createElement('img');
		var vm = this;

		return function(e) {
			/* base64 인코딩 된 스트링 데이터 */
			vm.image.src = e.target.result
		}
	})()

	upload.addEventListener('change', function(e) {
		var get_file = e.target.files;

		if (get_file) {
			reader.readAsDataURL(get_file[0]);
		}

		preview.appendChild(image);
	})

	var temp;

	function Userinput() {
		alert("수정되었습니다");
		var input = document.getElementById("input").value;
		temp = input;
	}
</script>
<script>var contextPath = "${pageContext.request.contextPath}";</script>
</html>