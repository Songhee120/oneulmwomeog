<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
   Astral by Pixelarity
   pixelarity.com | hello@pixelarity.com
   License: pixelarity.com/license
-->
<html>

<head>

<title>회원가입</title>
<meta charset="utf-8" />
<meta name="viewport"
   content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" href="../assets/css/main.css" />
<link rel="stylesheet" href="../assets/css/astral.css?ver=6" />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">

<noscript>
   <link rel="stylesheet" href="../assets/css/noscript.css" />
</noscript>
</head>
<style>
   /* 유효성 검사 css 2020-11/27*/
   /* user_password.html */
   /* 비밀번호 찾기 부분 아이디 유효성 검사입니다. */
   .message.bad {
       font-size: 13px;
       color:#E91E63;
       display: none;
   }
   .message.good {
       font-size: 13px;
       color:#2196F3;
       display: none;
   }
   .messageEmailBox.good .good{
       display: inline;
   }
   .messageEmailBox.bad .bad{
       display: inline;
   }
</style>
<style>
{
   font-family: 'Do Hyeon', sans-serif;
}


.btn {
   background-color: #fff;
   color: #616161;
   border: 2px solid #bdbdbd;
   border-radius: 10px;
   width: 160px;
   height: 80px;
   margin: 10px;
   font-size: 18px;
}

span.holy {
   font-family: 궁서;
   font-size: 40px;
   color: pink;
}
</style>
<body class="is-preload">

   <!-- Wrapper-->
   <div id="wrapper">

      <!-- Nav -->
      <nav id="nav">
         <a href="#signup" class="icon solid fa-sign-in-alt"><span>회원가입</span></a>
      </nav>

      <!-- Main -->
      <div id="main">
         <!--다시 만들어야겠다.-->
         <article id="signup" class="panel">
            <header style="text-align: center;">
               <a href="index.jsp#home" style="text-decoration:none; font-size:45px; color:#ffcccc; font-weight:900;">오늘뭐먹</a>
            </header>
            <form action = "${pageContext.request.contextPath}/member/MemberJoinOk.me" method="post" name="form">
               <div class="col-12">
                  <label id="jogin_label">아이디 
                  <input type="text" name="join_id"/></label>
                  <span class="jogin_span" id="id_result" style="display:block;"></span>
               </div>
               <div class="col-12">
                  <label id="jogin_label">이메일</label>
                  <input type="text" name="join_email" style="width:60%;display:inline-block"/>
                  <select name="sub_email" style="width:40%;float:right;">
                  		<option>이메일 선택</option>
                  		<option>@naver.com</option>
                  		<option>@gmail.com</option>
                  		<option>@daum.net</option>
                  </select>
                  <span class="jogin_span" id="email_result" style="display:block;"></span>
               </div>
               <div class="col-12">
                  <div style="padding:0px;width:49%;display:inline-block"><label for="join_password" id="jogin_label">비밀번호</label></div>
                  <div style="padding:0px;width:49%;float:right;"><label for="re_password" id="jogin_label">비밀번호 재확인</label></div>
                  <div style="padding:0px;width:49%;display:inline-block;">
                  	<input type='password' name='join_password' id="join_password"/>
                  	<div >
                  	<span class="jogin_span" id="pw_result"> </span>
                  	</div>
                  </div>
                  <div style="padding:0px;width:49%;margin-left:2%;float:right;">
                  	<input type='password' name="re_password" id="re_password" />
                  	<div><span class="jogin_span" id="re_pw_result"></span></div>
                  </div>
               </div>
               
               <div class="col-12">
                  <div style="padding:0px;width:49%;display:inline-block"><label for="name" id="jogin_label">이름</label></div>
                  <div style="padding:0px;width:49%;float:right;"><label for="nickname" id="jogin_label">닉네임</label></div>
                  <div style="padding:0px;width:49%;display:inline-block;">
                  	<input type='text' name="name" id="name" />
                  	<span class="jogin_span" id="name_result"></span>
                  </div>
                  <div style="padding:0px;width:49%;margin-left:2%;float:right;">
                  	<input type='text' name="nickname" id="nickname" />
                  </div>
               </div>
               
               <div class="col-12">
                  <label id="jogin_label">생년월일</label> 
                  <select id="year" name="year">
                  </select>
                  <select id="mon" name="mon">
                  </select>
                  <select id="day" name="day">
                  </select>                                               
                  <span class="jogin_span" id="birth_result"></span>
               </div>
               <div class="col-12" style="margin: 0 auto; display: block;">                  
                  <div style="padding:0px;"><label for="tel" id="jogin_label">전화번호(-제외)</label></div>
                  <div style="padding:0px;">
                  	<input type='text' name='tel' style="width:75%;margin-left:0px;display:inline-block;" />
                  	<input type="button" onclick="mean()" id="mean_btn" name="phone_mean_btn" value="인증">
                  	<span class="jogin_span" id="tel_result"></span>
                  </div>
               </div>   
               <div class="col-12" style="margin: 0 auto; display: block;">
                  <div style="padding:0px;"><label id="jogin_label">인증번호</label></div>
                  <div style="padding:0px;">
                  	<input type='text' name='mean_tel' readonly style="width:75%;margin-left:0px;display:inline-block;" />
                  	<input type="button" id="resubmit_btn" name="resubmit_phone_btn" value="재전송">
                  </div>
               </div>   
               <div class="col-12" style="margin: 0 auto; text-align: center;">
                  <button type="button" class="btn"
                     style="padding: 0; width: 120px; height: 50px;"onclick="join_cancel()">취소</button>               
                  <input type="button" class="join_btn" id="join_btn" onclick="join_check()" value="가입하기" />
               </div>
            </form>
         </article>

      </div>

      <!-- Footer -->
      <div id="footer">
         <ul class="copyright">
            <li>&copy; Untitled.</li>
         </ul>
      </div>

   </div>

   <!-- Scripts -->
   <script src="../assets/js/jquery.min.js"></script>
   <script src="../assets/js/browser.min.js"></script>
   <script src="../assets/js/breakpoints.min.js"></script>
   <script src="../assets/js/util.js"></script>
   <script src="../assets/js/main.js"></script>
   <script src="../assets/js/astral.js?ver=1"></script>
</body>
<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
<script>var contextPath = "${pageContext.request.contextPath}"</script>
<script>

	function join_check() {
		var msg = "필수정보입니다.";
		var form = document.form;
		var check = false;
		
		if(form.join_id.value == ""){
			$("#id_result").text(msg);
			check = true;
		}
		
		if(form.join_email.value == ""){
			$("#email_result").text(msg);
			check = true;
		}else{
			$("#email_result").text("");
		}
		
		
		var pw_check = false;
		if(form.join_password.value == ""){
			$("#pw_result").css("display", "block");
			$("#pw_result").text(msg);
			check = true;
		} else {
			//8자리 이상, 대문자/소문자/숫자/특수문자 모두 포함되어 있는 지 검사
			var reg = /^(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;
			var hangleCheck = /[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/;
			var err_msg = null;
			if(!reg.test(form.join_password.value)){
				err_msg = "비밀번호는 8자리 이상이며, 소문자/숫자/특수문자 모두 포함해야 합니다.";
				pw_check = true;
			}else if(/(\w)\1\1\1/.test(form.join_password.value)){
				err_msg = "같은 문자는 4번 이상 사용하실 수 없습니다.";
				pw_check = true;
			}else if(form.join_password.value.search(form.join_id.value) > -1){
				err_msg = "비밀번호에 아이디는 포함 할 수 없습니다.";
				pw_check = true;
			}else if(hangleCheck.test(form.join_password.value)){
				err_msg = "비밀번호에 한글을 사용할 수 없습니다.";
				pw_check = true;
			}else if((form.join_password.value.search(/\s/) != -1)){
				err_msg = "비밀번호에 공백 없이 입력해주세요.";
				pw_check = true;
			}
			
			if(pw_check){
				$("#pw_result").text(err_msg);
			}else{
				$("#pw_result").text("");
			}
		}
		
		if(form.re_password.value == ""){
			$("#re_pw_result").text(msg);
			check = true;
		} else {
			if (form.join_password.value != form.re_password.value) {
				$("#re_pw_result").text("비밀번호가 일치하지 않습니다.");
			} else {
				$("#re_pw_result").text("");
			}
		}
	
		if (form.name.value == "") {
			$("#name_result").text(msg);
			check = true;
		} else {
			$("#name_result").text("");
		}
	
		if (form.year.value == "" || form.day.value == "" || form.mon.value == "") {
			$("#birth_result").text(msg);
			check = true;
		} else {
			$("#birth_result").text("");
		}
		
		
		var tel_reg = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[#?!@$%^&*-])$/;
		
		if (form.tel.value == "") {
			$("#tel_result").text(msg);
			check = true;
		} else {
			var tel_check = false;
			var err_msg = null;
			if(tel_reg.test(form.tel.value)){
				tel_check = true;
				console.log("들어옴");
				err_msg = "잘못된 값이 들어있습니다.";
			}
			
			if(!tel_check){
				$("#tel_result").text("");
			}
		}
		
		if(!check){
			form.submit();
		}
		
	}
	var id_check = false;

	//아이디 input에 입력이 발생하면 함수 실행
	$("input[name='join_id']").keyup(function(event) {
		//아이디에 입력한 값이 담기고
		var id = $("input[name='join_id']").val();
		//checkId메소드 실행
		checkId(id);
	});

	function checkId(id) {
		console.log(id);
		//입력했을 때 공백이면 msg출력
		if (id == "") {
			$("#id_result").text("아이디를 입력해주세요");
		} else {
			//값이 공백이 아니라면 ajax를 통해 실시간 DB와 비교한다.
			$.ajax({
				//id를 파라미터에 담아 전송할 경로
				url : contextPath + "/member/MemberCheckIdOk.me?id=" + id,
				//id를 보내야하므로 get
				type : "get",
				//출력은 text로 받는다.
				dataType : "text",
				//성공
				success : function(result) {
					//결과의 공백을 제거하고 비교하여 ok이면 사용 가능
					if (result.trim() == "ok") {
						id_check = true;
						$("#id_result").text("사용할 수 있는 아이디입니다.");
					} else {
						$("#id_result").text("중복된 아이디입니다.");
					}
				},
				error : function() {
				}
			})

		}
	}

	$(document).ready(function() {
		setDateBox();
	})

	function setDateBox() {
		var date = new Date();
		var year = "";
		var com_year = date.getFullYear();

		$("#year").append("<option value=''>년도</option");

		for (var i = (com_year - 50); i <= (com_year + 1); i++) {
			$("#year").append("<option value='"+ i +"'>" + i + "</option>");
		}

		var month = "";

		$("#mon").append("<option value=''>월</option>");

		for (var i = 1; i <= 12; i++) {
			$("#mon").append("<option value='"+ i +"'>" + i + "</option>");
		}

		var day = "";

		$("#day").append("<option value=''>일</option>");

		for (var i = 1; i <= 31; i++) {
			$("#day").append("<option value='"+ i +"'>" + i + "</option>");
		}
	}
	

	//전화번호 인증 버튼 ajax 
	$("input[name='phone_mean_btn']").click(function() {
		var phone_check;
		var phone = $("input[name='tel']").val();

		if (phone == "") {
			alert("전화번호를 입력해주세요.");
			
		} else {
			$.ajax({
				url : contextPath + "/member/MemberSendPhoneNo.me?phone=" + phone,
				type : "get",
				//출력은 text로 받는다.
				dataType : "text",
				//성공
				success : function(result) {
					//결과의 공백을 제거하고 비교하여 ok이면 사용 가능
					var msg = null;
					if (result.trim() == "ok") {
						msg = "인증번호를 발송하였습니다.";
						phone_check = true;
					} else {
						msg = "발송 실패";
					}
					alert(msg);
				},
				error : function() {
				}
			})

		}
	})

	//인증번호 재전송 ajax
	$("input[name='resubmit_phone_btn']").click(function() {
		var phone_resubmitCheck;
		var phone = $("input[name='mean_tel']").val();

		if ($("input[name='id_mean']").attr("readOnly")) {
			return false;
		}

		if (phone == "") {
			alert("인증번호를 입력해주세요.");
			
		} else {
			$.ajax({
				url : contextPath + "/member/MemberSendPhoneNo.me?phone=" + phone,
				
				type : "get",
				//출력은 text로 받는다.
				dataType : "text",
				//성공
				success : function(result) {
					//결과의 공백을 제거하고 비교하여 ok이면 사용 가능
					var msg = null;
					if (result.trim() == "ok") {
						msg = "인증번호를 발송하였습니다.";
						phone_resubmitCheck = true;
					} else {
						msg = "발송 실패";
					}
					alert(msg);
				},
				error : function() {
				}
			})

		}
	})

</script>
</html>