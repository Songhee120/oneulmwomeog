<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE HTML>
<!--
   Astral by Pixelarity
   pixelarity.com | hello@pixelarity.com
   License: pixelarity.com/license
-->
<html>
<head>
<title>오늘뭐먹</title>
<meta charset="utf-8" />
<meta name="viewport"
   content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" href="../assets/css/main.css?ver=1" />
<link rel="stylesheet" href="../assets/css/astral.css?ver=16" />
<link rel="stylesheet" href="../assets/css/prac.css?ver=8" />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">

<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
<noscript>
   <link rel="stylesheet" href="../assets/css/noscript.css" />
</noscript>
</head>
<style>
	*{
	   font-family: 'Do Hyeon', sans-serif;b
	}
	
	span.holy {
	   font-family: 궁서;
	   font-size: 40px;
	   color: pink;
	}
	button {
		border-radius: 10px;
	}
	.bar{
		margin:0 3px;
		width:1px;
		height:7px;
		vertical-align:center;
		font-size:12px;
		margin-left:6px;
		padding-top:1px;
	}
	.rice_Level{
	    width: 40px;
	    height: 40px;
	    float: right;
	    margin-top: 15px;
	 }
    a:link { color: black; text-decoration: none;}
	a:visited { color: black; text-decoration: none;}
 	a:hover { color: black; text-decoration: underline;}
	 
	
</style>
<style>
	#reload{
		cursor:pointer;
	}
	#reload:hover{
		color:rgb(239, 154, 154);
	}
	.fa-history:hover{
		color:black;
	}
	.loading{
		width:100%;
	    height:100%;
	    position:fixed;
	    left:0px;
	    top:0px;
	    background:white;
	    opacity:0.3;
	    z-index:1000; /* 이 값으로 레이어의 위치를 조정합니다. */
	}
	.home_select_btn {
		width: 200px;
		height: 100px;
		font-size: 25px;
	}
	#noReviewNotice {
	   width: 100%;
	   height: 100px;
	   background-color: #eeeeee;
	   color: black;
	}
	@media ( max-width :1024px) {
	   #noReviewNotice {
	      height: 80px;
	   }
	}
</style>
<c:if test="${mem_id eq null}">
	<script>
		alert("로그인 후 이용해주세요.");
		location.replace("${pageContext.request.contextPath}/member/MemberLogin.me");
	</script>
</c:if>
<c:set var="id" value="${sessionScope.mem_id}"/>
<body class="is-preload" onload="noBack()" onpageshow="if(event.persisted) noBack();" onunload="">
   <!-- Wrapper-->
   <div id="wrapper">
	
      <!-- Nav -->
      <nav id="nav" style="">
         <a href="#home" class="icon solid fa-home"><span>Home</span></a> <a
            href="#post" onclick="best()" class="icon solid fa-folder"><span>Post</span></a>
         <a href="#myPage" onclick="myPageAction()" class="far fa-id-card"><span>MyPage</span></a>
      </nav>
	  <c:set var="bestList" value="${requestScope.bestList}"/>
      <!-- Main -->
      <div id="main">

         <!-- Me -->
         <article id="home" class="panel" style="padding-top:2.5em;">
            <section id="my_home">
					<header id="home_header">
						<div id="home_header_div1">
							<img src="../images/mainlogo.png" id="home_img">
						</div>
						<div id="home_header_div2">
							<span id="home_name">오늘 뭐먹</span>
						</div>
					</header>
					<div id="my_home_div1">
						<div id="home_div1-1" style="height: 50px;">
							<span>WE HAVE TO EAT ONEULMWOMEOG</span>
						</div>
						<div style="height: 50px;">
							<span>FOOD FOREVER</span>
						</div>
					</div>
					<div id="my_home_div2">
						<button id="res_select_btn" class="home_select_btn">밥먹을래?</button>
						<a href="${pageContext.request.contextPath}/cafe/CafeSelect.fo"><button id="cafe_select_btn" class="home_select_btn">카페갈래?</button></a>
					</div>
				</section>
            <!-- 음식 길 찾기 끝 -->
         </article>

                  <!-- Post -->
         <article id="post" class="panel" style="text-align: center;">
            <header>
               <h2>POST</h2>
            </header>
            <div style="text-align: center;">
               <i class="fas fa-history" onclick="best()"style="font-size:25px;cursor:pointer"></i>
               <span id="best" onclick="bestClicked()">BEST</span>
               <span id="new" style="margin: 20px;">
               <a href="${pageContext.request.contextPath}/review/ReviewNewViewFirst.re" style="color: rgb(119, 119, 119);">NEW</a></span>
            </div>
            <!-- best 인증 -->
            <section id="best_area"style="display: block; text-align: center;">
               <div style="width: 100%; text-align: right;">           
                  <div style="width:100%; height:30px;">              		
                  </div>
               </div>
               <br>
               <div class="row" id="best_view">              
               </div>
               <br>
            </section>
            <!-- new 인증_이미지 -->
            <section id="new_image_area" style="display: none; text-align: center;">
               <div style="width: 100%; text-align: right;">
                  <div style="width:100%; height:15px;">
                     <span id="new_image" onclick="newImageClicked()"><select
                        class="select_choice">
                           <option value="" style="color: #777777">선택</option>
                           <option value="local">지역</option>
                           <option value="name">상호명</option>
                     </select> <input id="notices_search" maxlength="50" type="search" style="height:23px">
                        <!--12-08  --> <input id="search_btn" type="button" value="검색"></span>
                  </div>
            
               <br>
               <div class="row" id="best_view">
               </div>
               <br>
      
            </section>
            <!-- new 인증_텍스트 -->
            <!-- 변경한 부분은 태그 안에서 직접 변경함 -->

         </article>

          <article id="myPage" class="panel" style="color:black;">
				<header style="margin:8px;">
					<h2 style="text-align:center;">마이페이지</h2>
				</header>
				<hr style="padding:0px;margin:auto;">
				<section style="height:700px;">
					<!--사용자 -->
					<div class="row" style="padding:0px;height:10%;margin:0 auto;">
						<div style="line-height:70px;padding:0px;display:inline-block;width:10%;text-align:center;height:100%;">
							<img src="" id="user_img">
						</div>
						<div style="padding:0px;display:inline-block;width:50%;">
							<div style="padding:0px;display:block;height:35px;">
								<span id="user_name"></span>
								<a href="${pageContext.request.contextPath}/member/MemberMydetail.me"><button id="my_inform_btn" onclick="move_my_inform()">내 정보</button></a>
							</div>
							<div style="padding:0px;display:block;height:35px;line-height:45px;">
								<span id="user_nickname" ></span>
							</div>
						</div>
						<div style="text-align:right;float:right;width:40%;padding:0px;line-height:70px">				
							<span style="margin-right:15px;"><span id="user_point"></span><img src="../images/point.png" id="my_point_img"></span>
							<a href=" ${pageContext.request.contextPath}/member/MemberLogOut.me" style="float:right;"><button id="logout_btn">로그 아웃</button></a>
						 	<i class="fas fa-exclamation-circle" onclick="popup()" style="margin-top: 21px;float: right;margin-right: 5px; font-size: 30px; cursor: pointer; ">
                          	</i>                                        
		                    <img class="rice_Level" src="">
		                    <!-- 팝업창에 value를 넘겨준다 -->
		                    <input id="mem_id" type="hidden" value="${id}" style="display:none;">
		                    <input id="mem_rank" type="hidden" value="" style="display:none;">
		                    <input id="mem_review_cnt" type="hidden" value="" style="display:none;">
		                    <input id="mem_heart" type="hidden" value="" style="display:none;">
		                    <input id="rank_img" type="hidden" value="" style="display:none;"> 
						</div>
					</div>
					<hr style="margin:0px;padding:0px;">		
					<nav id="mypage_nav">						 
						<div class="row" id="nav" style="padding:0px;height:100%;margin:0 auto;">
							 <div style="height:50%;padding:0px;width:100%">
								<div class="six_div">
									<div class="my_img_div">
										<a href="#" class="my_img_a">
										<img src="../images/present.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>이벤트</span>
									</div>
								</div>
								<div class="six_div">
									<div class="my_img_div">
										<a href="#" class="my_img_a">
										<img src="../images/discount.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>쿠폰함</span>
									</div>
								</div>
								<div class="six_div">
									<div class="my_img_div">
										<a href="${pageContext.request.contextPath}/notice/NoticeList.no" class="my_img_a">
										<img src="../images/notice.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>공지사항</span>
									</div>
								</div>
								
							</div>
							<div style="height:50%;padding:0px;width:100%">
								<div class="six_div">
                           			<div class="my_img_div">
                              			<a href="${pageContext.request.contextPath}/scrap/ScrapViewFirstOk.sc" class="my_img_a">
                              			<img src="../images/zzim.jpg"class="my_img_img"> </a>
                           			</div>
                           			<div class="my_text">
                              			<span>찜 목록</span>
                           			</div>
                        		</div>
                        		
								<div class="six_div">
									<div class="my_img_div">
										<a href="${pageContext.request.contextPath}/confirm/ReviewConfirmList.co" class="my_img_a">
										<img src="../images/certify.jpg"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>리뷰 목록</span>
									</div>
								</div>
								
								<div class="six_div">
									<div class="my_img_div">
										<a href="#" class="my_img_a">
										<img src="../images/custom_center.png"class="my_img_img"> </a>
									</div>
									<div class="my_text">
										<span>고객센터</span>
									</div>
								</div>
							</div>																						
						</div>
					</nav><hr style="margin:0px;padding:0px;">	
					<div class="row" id="main" style="padding:0px;height:47%;margin:0 auto;">
						<div id="my_alarm">
							<div style="width:20%;display:inline-block;height:100%;">
								<span>알람</span>
							</div>
							<div style="width:80%;float:right;text-align:right;height:100%"><button id="alarm_delete"><span>전체 삭제</span></button></div>
						</div>
						<div id="my_zzim">
							<div id="my_zzim_inner_div">
								<div class="my_zzim_div">
									<div id="my_zzim_div_1">
										<span id="my_zzim_date">12/2 <span>AM)12:16</span></span>
										<span>|</span>
										<span>쌍용 부부...</span>
									</div>
									<div id="my_zzim_div_2">
										<span id="my_zzim_review"><span>Eungeun</span>님이 좋아요!</span>
									</div>
									<div id="my_zzim_div_3">
										<button id="my_cancel_btn"><img src="../images/x_img.jpg" id="cancel_img"></button>
									</div>
								</div>
								<div></div>
								<div></div>
								<div></div>
							</div>
						</div>
						
			
					</div>
				</section>
			</article>
      </div>
	  
      <!-- Footer -->
      <div id="footer">
         <ul class="copyright">
            <li>&copy; Untitled.</li>
         </ul>
      </div>
	
   </div>
   <!-- Scripts -->
   <script src="../assets/js/jquery.min.js"></script>
   <script src="../assets/js/browser.min.js"></script>
   <script src="../assets/js/breakpoints.min.js"></script>
   <script src="../assets/js/util.js"></script>
   <script src="../assets/js/main.js"></script>
</body>
<script src="//code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="../assets/js/astral.js"></script>
<script>var contextPath = "${pageContext.request.contextPath}"</script>
<script>
	/* //뒤로가기 막기
	window.history.forward();
	function noBack(){
		window.history.forward();
	} */
</script>
<script>

	/* 등급 안내 팝업 */
	function popup(){
	    var url = contextPath + "/member/level_box.jsp#findmyLv";
	    var name = "popup test";
	    var width = '650';
	    var height = '700';
	 
	    // 팝업을 가운데 위치시키기 위해 아래와 같이 값 구하기
	    var left = Math.ceil(( window.screen.width - width )/2);
	    var top = Math.ceil((window.screen.height - height )/2); 
	
	    window.open(url, name, 'width='+ width +', height='+ height +', left=' + left + ', top='+ top);
	}

		

	$("#res_select_btn").click(function(){
		$.ajax({
			url:contextPath + "/food/FoodSelectCheck.fo",
			type:"get",
			dataType:"json",
			success:function(result){
				if(result.authority == "ok"){
					location.href = contextPath + "/food/food_select.jsp";
				}else{
					alert("1시간 이내에 사용하신 기록이 있습니다.(남은시간:"+result.time+"분)");
				}
			},
			error:function(result){}
		})
	})
	

	$(document).ready(function(){
		//best에서만 로딩을 보이게 하기 위해 임시적 사용, 더 좋은 방법을 찾아보자.
		if(window.location.href == "http://localhost:8081/astral/member/login_index.jsp#post"){
		 	best();			
		}
		if(window.location.href == "http://localhost:8081/astral/member/login_index.jsp#myPage"){
		 	myPageAction();			
		}
	})

	function myPageAction(){
         $.ajax({
            url:contextPath + "/member/MemberMyPage.me?check="+true,
            type:"post",
            dataType:"json",
            success:function(mem){              
               $("#user_img").attr("src", contextPath + "/profile/" + mem.mem_profile);
               $("#user_name").text(mem.mem_name);
               $("#user_nickname").text(mem.mem_nickname);
               $("#user_point").text(mem.mem_point);
               $(".rice_Level").attr("src", contextPath + "/images/" + mem.mem_rank_file);
               $("#mem_rank").val(mem.mem_rank_name);
               $("#mem_review_cnt").val(mem.mem_review_cnt);
               $("#mem_heart").val(mem.mem_heart);
               var path = contextPath + "/images/" + mem.mem_rank_file;
               $("#rank_img").val(path);
               /* 회원의 리뷰 수와 좋아요 수를 비교하여 등급이 바뀌면 alert창을 띄워준다. */
               if(mem.mem_rank_change){
                    alert("회원님의 등급이 " + mem.mem_rank_name + "가 되셨습니다.");                    
               }
            },
            error:function(mem){
               alert("로딩 실패");
            }
         })
      }

	function best(){
         $.ajax({
       	  	   url : contextPath + "/review/ReviewBestView.re",
               type : "get",
               dataType : "json",
               success : best_view,
               beforeSend: function () {
                   var width = 50;
                   var height = 50;
                   var left = 0;
                   var top = 0;
                   /* $( window ).resize(function() {
						윈도창 바뀌는 것 감지 함수
                   });     */            	
                   top = ( $("body").height() - height ) / 2 + $("body").scrollTop();
                   left = ( $("body").width() - width ) / 2 + $("body").scrollLeft();
				   //첫 실행 시에는 아예 태그가 존재하지 않으므로 들어오지 않는다.
				   //한 번 실행 된 후 필요할 때마다 보여준다.
                   if($(".loading").length != 0) {
                          $("#div_ajax_load_image").css({
                                 "top": top+"px",
                                 "left": left+"px"
                          });
                          $(".loading").show();
                   }
                   //첫 실행 할 때 실행
                   else {                          	                   	   	 
                          $('body').append('<div class="loading"><div id="div_ajax_load_image" style="position:absolute; top:' + top + 'px; left:' + left + 'px; width:' + width + 'px; height:' + height + 'px; z-index:9999; background:gray; filter:alpha(opacity=50); opacity:alpha*0.5; margin:auto; padding:0; "><img src="'+contextPath+'/images/loader.gif" style="width:50px; height:50px;"></div></div>');
                   }

              }, complete: function () {    
            	  		  //태그 숨기기
                          $(".loading").hide();
              },
                 error : function(result) {
                   		  alert("실패");
              }
         });
	} 
		    
	function best_view(result){
		var append = "";
		//result에 값이 있고 길이가 0이 아니라면
		if(result != null && result.length != 0){
		    $.each(result, function(index, res){
		         var append_div = "";
		         append_div += "<div class='col-4 col-6-medium col-12-small'>";
		         append_div += "<figure class='snip1384'>";
		         append_div += "<img src='../upload/" + res.filename+"' alt='sample83' />";
		         append_div += "<figcaption>";
		         append_div += "<h3>"
		         append_div += (index + 1) + "위";
		         append_div += "</h3>";
		         append_div += "<h3>";
		         append_div += res.res_name + "<br>";
		         append_div += "<span>";
		         for(var j = 0; j < res.review_star; j++){
		            append_div += "<c:out value='★'/>";
		         }
		         append_div += "</span>";
		         append_div += "</h3>";
		         append_div += "<p>"+ res.res_address+ "</p>";
		         append_div += "<i class='ion-ios-arrow-right'></i>";
		         append_div += "</figcaption>";
		         append_div += "<a href='"+contextPath+"/review/ReviewShowOk.re?review_no="+res.review_no+"'></a>";
		         append_div += "</figure>";
		         append_div += "</div>";
		         append += append_div;
		    })
		//result가 비었다면
	    $("#best_view").html(append);	
		}else{
			var append_div = "";
			append_div += "<div id='noReviewNotice'>'당일 게시물이 아직 올라오지 않았습니다.'</div>"
			$("#best_view").html(append_div);			
		}
	}
		    	
		    
	
	   
</script>
</html>